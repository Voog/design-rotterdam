!function(e){var t,a,i,o,r=e("html").hasClass("editmode"),s=function(e,t){for(var a,i=0,o=e.length;i<o;i++){if(e[i].width<t)return a||e[i];a=e[i]}return e[e.length-1]},n=function(e,t){for(var a=e.length;a--;)if(t.indexOf(e[a].url.trim())>-1)return!0;return!1},d=function(){headerBgCombinedLightness>=.5?e(".js-background-type").addClass("light-background").removeClass("dark-background"):e(".js-background-type").addClass("dark-background").removeClass("light-background")},l=function(t,a){return function(t,a){if(t&&a){"string"==typeof t&&(t=t.replace(/rgba?\(/,"").replace(/\)/,"").split(","),e.each(t,function(e,a){t[e]=+a})),"string"==typeof a&&(a=a.replace(/rgba?\(/,"").replace(/\)/,"").split(","),e.each(a,function(e,t){a[e]=+t})),"object"==typeof t&&t.hasOwnProperty("length")&&3==t.length&&t.push(1),"object"==typeof a&&a.hasOwnProperty("length")&&3==a.length&&a.push(1);var i=[0,0,0,0];return i[3]=1-(1-a[3])*(1-t[3]),0===i[3]&&(i[3]=1e-6),i[0]=Math.min(a[0]*a[3]/i[3]+t[0]*t[3]*(1-a[3])/i[3],255),i[1]=Math.min(a[1]*a[3]/i[3]+t[1]*t[3]*(1-a[3])/i[3],255),i[2]=Math.min(a[2]*a[3]/i[3]+t[2]*t[3]*(1-a[3])/i[3],255),e.map(i,function(e){return Math.floor(e)})}}(t||[255,255,255,1],a||[255,255,255,1])},g=function(e,t){var a=l(e,t);return Math.round((.2126*+a[0]+.7152*+a[1]+.0722*+a[2])/2.55)/100},c=function(e,t,a){var i=e.find(".js-content-item-img-drop-area"),o=e.find(".js-toggle-crop-state");t>a?i.removeClass("image-landscape image-square image-portrait").addClass("image-landscape"):t===a?i.removeClass("image-landscape image-square image-portrait").addClass("image-square"):i.removeClass("image-landscape image-square image-portrait").addClass("image-portrait"),i.hasClass("image-square")?o.removeClass("is-visible").addClass("is-hidden"):o.removeClass("is-hidden").addClass("is-visible")},h=function(t,a,i,o,r){var s="article"===r?"articles":"pages",n=new Edicy.CustomData({type:r,id:i});e.ajax({type:"PATCH",contentType:"application/json",url:"/admin/api/"+s+"/"+i,data:JSON.stringify({image_id:o}),dataType:"json",success:function(e){n.set("image_crop_state","not-cropped"),t.removeClass("not-loaded with-error").addClass("is-loaded"),t.find(".edy-img-drop-area-placeholder").css("opacity",1),a.css("opacity",1)},timeout:3e4,error:function(e){t.removeClass("not-loaded is-loaded with-error").addClass("with-error")}})};window.site=e.extend(window.site||{},{toggleFlags:function(){e(".js-option-toggle-flags").on("click",function(t){if(t.stopPropagation(),e(this).hasClass("js-flag-disable-btn"))var a=!1;else a=!0;e(this).toggleClass("js-flag-disable-btn"),e("body").toggleClass("flags-enabled flags-disabled"),siteData.set("flags_state",a)})},headerBgPreview:function(t,a){var i=e(".js-header-banner").css("background-image"),o=t.imageSizes?s(t.imageSizes,e(window).width()):null,r=t.image&&""!==t.image?"url("+o.url+")":"none",l=t.imageSizes&&""!==t.imageSizes?t.imageSizes:null,c=t.color&&""!==t.color?t.color:"rgba(0,0,0,0)",h=(t.colorData&&""!==t.colorData&&t.colorData.lightness,e("<img>")),m=e("<canvas>"),u=t.image&&""!==t.image?t.image:null;u?n(l,i)?(headerBg.headerBgImageColor=headerBg.headerBgImageColor?headerBg.headerBgImageColor:"rgba(178,198,207,1)",headerBgCombinedLightness=g(headerBg.headerBgImageColor,c),d()):(h.attr("src",u.replace(/.*\/(photos|voogstock)/g,"/photos")),h.on("load",function(){ColorExtract.extract(h[0],m[0],function(e){headerBg.headerBgImageColor=e.bgColor?e.bgColor:"rgba(255,255,255,1)",headerBgCombinedLightness=g(headerBg.headerBgImageColor,c),d()})})):(headerBg.headerBgImageColor="rgba(255,255,255,1)",headerBgCombinedLightness=g(headerBg.headerBgImageColor,c),d()),e(a).css({"background-image":r}),e(a).find(".background-color").css({"background-color":c})},headerBgCommit:function(t,a){var i,o=e.extend(!0,{},t);o.image=t.image||"",o.imageSizes=null==(i=t.imageSizes)||"string"==typeof i&&i.match(/^[\\'"]+$/)?"":i,o.color=t.color||"rgba(255,255,255,0)",o.combinedLightness=headerBgCombinedLightness,pageData.set(a,o)},getImageByWidth:s,headerBgImageSizesContains:n,handleHeaderImageLightnessClass:d,bindCustomTexteditorStyles:function(e){window.edy=window.edy||[],edy.push(["texteditorStyles",{name:e,tagname:"a",attribute:{href:"#"},classname:"custom-btn",toggle:!0}])},bindContentItemImgDropAreas:function(t){e(".js-content-item-img-drop-area").each(function(a,i){var o=e(i),r=o.closest(".js-content-item-box"),s=r.data("item-id"),n=r.data("item-type");new Edicy.CustomData({type:n,id:s}),new Edicy.ImgDropArea(o,{positionable:!1,target_width:1280,placeholder:'<div class="edy-img-drop-area-placeholder">'+t+"</div>",removeBtn:'<div class="edy-img-drop-area-remove-image"><div class="edy-img-drop-area-remove-image-ico"><svg width="16" height="20" viewBox="0 0 26 30" xmlns="http://www.w3.org/2000/svg"><g fill-rule="nonzero" fill="currentColor"><g transform="translate(2 5)"><path d="M0 .997h2V21c0 1 1 2 2 2h14c1 0 2-1 2-2V1h2v20c0 2.25-1.75 4-4 4H4c-2.25 0-4-1.75-4-4V.997z"/><rect x="10" y="4" width="2" height="16" rx="1"/><rect x="5" y="4" width="2" height="16" rx="1"/><rect x="15" y="4" width="2" height="16" rx="1"/></g><path d="M26 4v2H0V4h7V2c0-1 1-2 2-2h8c1 0 2 1 2 2v2h7zM9 4h8V3c0-.5-.5-1-1-1h-6c-.5 0-1 .5-1 1v1z"/></g></svg></div></div>',change:function(e){var t;o.removeClass("is-cropped").addClass("not-cropped").css("opacity",.1),e?(t=e.original_id,r.removeClass("without-image is-loaded with-error").addClass("with-image not-loaded"),c(r,e.width,e.height)):(t=null,r.removeClass("with-image is-loaded with-error").addClass("without-image not-loaded"),r.find(".edy-img-drop-area-placeholder").css("opacity",0)),h(r,o,s,t,n)}})})},initSettingsEditorBtn:function(){window.addEventListener("DOMContentLoaded",function(t){var a=document.querySelector(".edy-next-shadowdom").shadowRoot,i=setInterval(function(){if(a.querySelectorAll('div[class^="toolbar__"]').length){var t=a.querySelector('div[class^="toolbar-expand"]'),o=a.querySelector('div[class^="toolbar__"]'),r=document.querySelector(".js-layout_settings-btn"),s=a.querySelector('div[class^="toolbar-content-item__"]');r.className=s.className+" "+r.className,o.insertBefore(r,t),a.querySelector(".js-layout_settings-btn").addEventListener("click",function(e){document.querySelector("body").classList.toggle("layout_settings-visible"),e.stopImmediatePropagation()}),a.querySelector(".js-layout_settings-btn").addEventListener("mouseenter",function(t){e(".layout_settings-tooltip").addClass("visible"),n()}),a.querySelector(".js-layout_settings-btn").addEventListener("mouseleave",function(t){e(".layout_settings-tooltip").removeClass("visible")});var n=function(){var t=e(".js-layout_settings-popover"),a=e(".layout_settings-arrow"),i=e(".layout_settings-tooltip");e(window).width()>768?(t.css({right:window.innerWidth-r.getBoundingClientRect().right-t.width()/2}),i.css({right:window.innerWidth-r.getBoundingClientRect().right-i.width()/2-r.getBoundingClientRect().width/2}),a.css({right:t.width()/2})):(t.css({right:0}),i.css({right:0}),a.css({right:72}))};e(window).resize((d=function(){n()},l=25,function(){var e=this,t=arguments,a=g&&!c;clearTimeout(c),c=setTimeout(function(){c=null,g||d.apply(e,t)},l),a&&d.apply(e,t)})),n(),clearInterval(i)}var d,l,g,c},500);e("body").append(e(".js-layout_settings-popover"))})},handleProductImageClick:function(t){e(".product-content .product-image").click(function(){window.open("/admin/ecommerce/products/"+t,"_blank").focus()})}}),!Modernizr.flexbox&&r&&(t=e(".js-header-inner").width(),a=e(".js-header-right"),i=a.width(),o=parseInt(a.css("margin-left"))+1,e(".js-header-left").css("min-width",t-i-o))}(jQuery);