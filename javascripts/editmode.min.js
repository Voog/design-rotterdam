var debounce=function(e,t,a){var i;return function(){var s=this,o=arguments,r=a&&!i;clearTimeout(i),i=setTimeout(function(){i=null,a||e.apply(s,o)},t),r&&e.apply(s,o)}},initSettingsEditorBtn=function(){window.addEventListener("DOMContentLoaded",function(e){var t=document.querySelector(".edy-next-shadowdom").shadowRoot,a=setInterval(function(){if(t.querySelectorAll('div[class^="toolbar__"]').length){var e=t.querySelector('div[class^="toolbar-expand"]'),i=t.querySelector('div[class^="toolbar__"]'),s=document.querySelector(".js-layout_settings-btn"),o=t.querySelector('div[class^="toolbar-content-item__"]');s.className=o.className+" "+s.className,i.insertBefore(s,e),t.querySelector(".js-layout_settings-btn").addEventListener("click",function(e){document.querySelector("body").classList.contains("layout_settings-visible")&&(document.querySelector("div.editor_default").style.display="none"),document.querySelector("body").classList.toggle("layout_settings-visible"),e.stopImmediatePropagation()});var r=function(){var e=$(".js-layout_settings-popover"),t=$(".layout_settings-arrow");$(window).width()>768?(e.css({right:window.innerWidth-s.getBoundingClientRect().right-e.width()/2}),t.css({right:e.width()/2})):(e.css({right:0}),t.css({right:72}))};$(window).resize(debounce(function(){r()},25)),r(),clearInterval(a)}},500);$("body").append($(".js-layout_settings-popover"))})};window.site=$.extend(window.site||{},{initSettingsEditorBtn:initSettingsEditorBtn}),function(e){var t,a,i,s,o=e("html").hasClass("editmode"),r=function(e,t,a){var i=e.find(".js-content-item-img-drop-area"),s=e.find(".js-toggle-crop-state");t>a?i.removeClass("image-landscape image-square image-portrait").addClass("image-landscape"):t===a?i.removeClass("image-landscape image-square image-portrait").addClass("image-square"):i.removeClass("image-landscape image-square image-portrait").addClass("image-portrait"),i.hasClass("image-square")?s.removeClass("is-visible").addClass("is-hidden"):s.removeClass("is-hidden").addClass("is-visible")},d=function(t,a,i,s,o){var r="article"===o?"articles":"pages",d=new Edicy.CustomData({type:o,id:i});e.ajax({type:"PATCH",contentType:"application/json",url:"/admin/api/"+r+"/"+i,data:JSON.stringify({image_id:s}),dataType:"json",success:function(e){d.set("image_crop_state","not-cropped"),t.removeClass("not-loaded with-error").addClass("is-loaded"),t.find(".edy-img-drop-area-placeholder").css("opacity",1),a.css("opacity",1)},timeout:3e4,error:function(e){t.removeClass("not-loaded is-loaded with-error").addClass("with-error")}})};o=function(){return e("html").hasClass("editmode")};window.site=e.extend(window.site||{},{toggleFlags:function(){e(".js-option-toggle-flags").on("click",function(t){if(t.stopPropagation(),e(this).hasClass("js-flag-disable-btn"))var a=!1;else a=!0;e(this).toggleClass("js-flag-disable-btn"),e("body").toggleClass("flags-enabled flags-disabled"),siteData.set("flags_state",a)})},bindContentItemImgDropAreas:function(t){e(".js-content-item-img-drop-area").each(function(a,i){var s=e(i),o=s.closest(".js-content-item-box"),n=o.data("item-id"),l=o.data("item-type");new Edicy.CustomData({type:l,id:n}),new Edicy.ImgDropArea(s,{positionable:!1,target_width:1280,placeholder:'<div class="edy-img-drop-area-placeholder">'+t+"</div>",removeBtn:'<div class="edy-img-drop-area-remove-image"><div class="edy-img-drop-area-remove-image-ico"><svg width="16" height="20" viewBox="0 0 26 30" xmlns="http://www.w3.org/2000/svg"><g fill-rule="nonzero" fill="currentColor"><g transform="translate(2 5)"><path d="M0 .997h2V21c0 1 1 2 2 2h14c1 0 2-1 2-2V1h2v20c0 2.25-1.75 4-4 4H4c-2.25 0-4-1.75-4-4V.997z"/><rect x="10" y="4" width="2" height="16" rx="1"/><rect x="5" y="4" width="2" height="16" rx="1"/><rect x="15" y="4" width="2" height="16" rx="1"/></g><path d="M26 4v2H0V4h7V2c0-1 1-2 2-2h8c1 0 2 1 2 2v2h7zM9 4h8V3c0-.5-.5-1-1-1h-6c-.5 0-1 .5-1 1v1z"/></g></svg></div></div>',change:function(e){var t;s.removeClass("is-cropped").addClass("not-cropped").css("opacity",.1),e?(t=e.original_id,o.removeClass("without-image is-loaded with-error").addClass("with-image not-loaded"),r(o,e.width,e.height)):(t=null,o.removeClass("with-image is-loaded with-error").addClass("without-image not-loaded"),o.find(".edy-img-drop-area-placeholder").css("opacity",0)),d(o,s,n,t,l)}})})}}),!Modernizr.flexbox&&o&&(t=e(".js-header-inner").width(),a=e(".js-header-right"),i=a.width(),s=parseInt(a.css("margin-left"))+1,e(".js-header-left").css("min-width",t-i-s))}(jQuery);