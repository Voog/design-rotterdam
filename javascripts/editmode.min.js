var debounce=function(e,t,a){var i;return function(){var o=this,s=arguments,r=a&&!i;clearTimeout(i),i=setTimeout(function(){i=null,a||e.apply(o,s)},t),r&&e.apply(o,s)}},initSettingsEditorBtn=function(){window.addEventListener("DOMContentLoaded",function(e){var t=document.querySelector(".edy-next-shadowdom").shadowRoot,a=setInterval(function(){if(t.querySelectorAll('div[class^="toolbar__"]').length){var e=t.querySelector('div[class^="toolbar-expand"]'),i=t.querySelector('div[class^="toolbar__"]'),o=document.querySelector(".js-layout_settings-btn"),s=t.querySelector('div[class^="toolbar-content-item__"]');o.className=s.className+" "+o.className,i.insertBefore(o,e),t.querySelector(".js-layout_settings-btn").addEventListener("click",function(e){document.querySelector("body").classList.contains("layout_settings-visible")&&(document.querySelector("div.editor_default").style.display="none"),document.querySelector("body").classList.toggle("layout_settings-visible"),e.stopImmediatePropagation()}),t.querySelector(".js-layout_settings-btn").addEventListener("mouseenter",function(e){$(".layout_settings-tooltip").addClass("visible"),r()}),t.querySelector(".js-layout_settings-btn").addEventListener("mouseleave",function(e){$(".layout_settings-tooltip").removeClass("visible")});var r=function(){var e=$(".js-layout_settings-popover"),t=$(".layout_settings-arrow"),a=$(".layout_settings-tooltip");$(window).width()>768?(e.css({right:window.innerWidth-o.getBoundingClientRect().right-e.width()/2}),a.css({right:window.innerWidth-o.getBoundingClientRect().right-a.width()/2-o.getBoundingClientRect().width/2}),t.css({right:e.width()/2})):(e.css({right:0}),a.css({right:0}),t.css({right:72}))};$(window).resize(debounce(function(){r()},25)),r(),clearInterval(a)}},500);$("body").append($(".js-layout_settings-popover"))})};window.site=$.extend(window.site||{},{initSettingsEditorBtn:initSettingsEditorBtn}),function(e){var t,a,i,o,s=e("html").hasClass("editmode"),r=function(t,a){return function(t,a){if(t&&a){"string"==typeof t&&(t=t.replace(/rgba?\(/,"").replace(/\)/,"").split(","),e.each(t,function(e,a){t[e]=+a})),"string"==typeof a&&(a=a.replace(/rgba?\(/,"").replace(/\)/,"").split(","),e.each(a,function(e,t){a[e]=+t})),"object"==typeof t&&t.hasOwnProperty("length")&&3==t.length&&t.push(1),"object"==typeof a&&a.hasOwnProperty("length")&&3==a.length&&a.push(1);var i=[0,0,0,0];return i[3]=1-(1-a[3])*(1-t[3]),0===i[3]&&(i[3]=1e-6),i[0]=Math.min(a[0]*a[3]/i[3]+t[0]*t[3]*(1-a[3])/i[3],255),i[1]=Math.min(a[1]*a[3]/i[3]+t[1]*t[3]*(1-a[3])/i[3],255),i[2]=Math.min(a[2]*a[3]/i[3]+t[2]*t[3]*(1-a[3])/i[3],255),e.map(i,function(e){return Math.floor(e)})}}(t||[255,255,255,1],a||[255,255,255,1])},n=function(e,t){var a=r(e,t);return Math.round((.2126*+a[0]+.7152*+a[1]+.0722*+a[2])/2.55)/100},d=function(e,t,a){var i=e.find(".js-content-item-img-drop-area"),o=e.find(".js-toggle-crop-state");t>a?i.removeClass("image-landscape image-square image-portrait").addClass("image-landscape"):t===a?i.removeClass("image-landscape image-square image-portrait").addClass("image-square"):i.removeClass("image-landscape image-square image-portrait").addClass("image-portrait"),i.hasClass("image-square")?o.removeClass("is-visible").addClass("is-hidden"):o.removeClass("is-hidden").addClass("is-visible")},l=function(t,a,i,o,s){var r="article"===s?"articles":"pages",n=new Edicy.CustomData({type:s,id:i});e.ajax({type:"PATCH",contentType:"application/json",url:"/admin/api/"+r+"/"+i,data:JSON.stringify({image_id:o}),dataType:"json",success:function(e){n.set("image_crop_state","not-cropped"),t.removeClass("not-loaded with-error").addClass("is-loaded"),t.find(".edy-img-drop-area-placeholder").css("opacity",1),a.css("opacity",1)},timeout:3e4,error:function(e){t.removeClass("not-loaded is-loaded with-error").addClass("with-error")}})};s=function(){return e("html").hasClass("editmode")};window.site=e.extend(window.site||{},{toggleFlags:function(){e(".js-option-toggle-flags").on("click",function(t){if(t.stopPropagation(),e(this).hasClass("js-flag-disable-btn"))var a=!1;else a=!0;e(this).toggleClass("js-flag-disable-btn"),e("body").toggleClass("flags-enabled flags-disabled"),siteData.set("flags_state",a)})},headerBgPreview:function(t,a){var i=e(".js-header-banner").css("background-image"),o=t.imageSizes?getImageByWidth(t.imageSizes,e(window).width()):null,s=t.image&&""!==t.image?"url("+o.url+")":"none",r=t.imageSizes&&""!==t.imageSizes?t.imageSizes:null,d=t.color&&""!==t.color?t.color:"rgba(0,0,0,0)",l=(t.colorData&&""!==t.colorData&&t.colorData.lightness,e("<img>")),g=e("<canvas>"),c=t.image&&""!==t.image?t.image:null;c?headerBgImageSizesContains(r,i)?(headerBg.headerBgImageColor=headerBg.headerBgImageColor?headerBg.headerBgImageColor:"rgba(178,198,207,1)",headerBgCombinedLightness=n(headerBg.headerBgImageColor,d),handleHeaderImageLightnessClass()):(l.attr("src",c.replace(/.*\/(photos|voogstock)/g,"/photos")),l.on("load",function(){ColorExtract.extract(l[0],g[0],function(e){headerBg.headerBgImageColor=e.bgColor?e.bgColor:"rgba(255,255,255,1)",headerBgCombinedLightness=n(headerBg.headerBgImageColor,d),handleHeaderImageLightnessClass()})})):(headerBg.headerBgImageColor="rgba(255,255,255,1)",headerBgCombinedLightness=n(headerBg.headerBgImageColor,d),handleHeaderImageLightnessClass()),e(a).css({"background-image":s}),e(a).find(".background-color").css({"background-color":d})},headerBgCommit:function(t,a){var i,o=e.extend(!0,{},t);o.image=t.image||"",o.imageSizes=null==(i=t.imageSizes)||"string"==typeof i&&i.match(/^[\\'"]+$/)?"":i,o.color=t.color||"rgba(255,255,255,0)",o.combinedLightness=headerBgCombinedLightness,pageData.set(a,o)},bindCustomTexteditorStyles:function(e){window.edy=window.edy||[],edy.push(["texteditorStyles",{name:e,tagname:"a",attribute:{href:"#"},classname:"custom-btn",toggle:!0}])},bindContentItemImgDropAreas:function(t){e(".js-content-item-img-drop-area").each(function(a,i){var o=e(i),s=o.closest(".js-content-item-box"),r=s.data("item-id"),n=s.data("item-type");new Edicy.CustomData({type:n,id:r}),new Edicy.ImgDropArea(o,{positionable:!1,target_width:1280,placeholder:'<div class="edy-img-drop-area-placeholder">'+t+"</div>",removeBtn:'<div class="edy-img-drop-area-remove-image"><div class="edy-img-drop-area-remove-image-ico"><svg width="16" height="20" viewBox="0 0 26 30" xmlns="http://www.w3.org/2000/svg"><g fill-rule="nonzero" fill="currentColor"><g transform="translate(2 5)"><path d="M0 .997h2V21c0 1 1 2 2 2h14c1 0 2-1 2-2V1h2v20c0 2.25-1.75 4-4 4H4c-2.25 0-4-1.75-4-4V.997z"/><rect x="10" y="4" width="2" height="16" rx="1"/><rect x="5" y="4" width="2" height="16" rx="1"/><rect x="15" y="4" width="2" height="16" rx="1"/></g><path d="M26 4v2H0V4h7V2c0-1 1-2 2-2h8c1 0 2 1 2 2v2h7zM9 4h8V3c0-.5-.5-1-1-1h-6c-.5 0-1 .5-1 1v1z"/></g></svg></div></div>',change:function(e){var t;o.removeClass("is-cropped").addClass("not-cropped").css("opacity",.1),e?(t=e.original_id,s.removeClass("without-image is-loaded with-error").addClass("with-image not-loaded"),d(s,e.width,e.height)):(t=null,s.removeClass("with-image is-loaded with-error").addClass("without-image not-loaded"),s.find(".edy-img-drop-area-placeholder").css("opacity",0)),l(s,o,r,t,n)}})})}}),!Modernizr.flexbox&&s&&(t=e(".js-header-inner").width(),a=e(".js-header-right"),i=a.width(),o=parseInt(a.css("margin-left"))+1,e(".js-header-left").css("min-width",t-i-o))}(jQuery);